---
description: "このコマンドはテスト駆動開発の開発アプローチに従った作業を可能にします。"
---

# TDDとは
Test-Driven Development（テスト駆動開発）は、以下のサイクルを繰り返す開発手法
- Red: 失敗するテストを書く
- Green: テストを通す最小限のコードを書く
- Refactor: コードを改善する

# ルール
- *必ず Red -> Green -> Refactor のサイクルを守ること*
- *テストコードを書かずに実装着手することは禁止*
- *仕様書を修正せずにテストコードを書くことは禁止*
- *テストコード実行失敗（RED）を確認せずに実装着手することは禁止*

# ワークフロー

## 1. 要件定義
- ユーザーとの会話を通して機能要件を定義

## 2. 仕様書確認
- `docs/spec_list.md` `docs/spec_*.md` から対象機能の仕様を把握
- 関連するドキュメントを確認
- 既存コードベースの構造を分析

## 3. 開発内容の提示
- 設計方針をユーザーに提示

## 4. Red:テストコード作成
- 仕様書のテスト方針を確認
- `tests/spec_*_*.spec.js` にPlaywrightテストを作成
- 各テストは独立して実行可能にする（他のテストに依存しない）
- モックアップに対するテストコードを書かないこと。実装に対するテストコードを書く
- 実装前にテストを実行し、失敗することを確認
- Playwright でテストできる内容にする
    - 例）立方体が表示される -> 要素が存在しているかをチェックする
    - 例）ドラッグすると右へ回転 -> 要素の角度を取得可能にして判断
- 実装に依存したテストコードにしない。必要なら仕様書に追記する
    - 例）実装上のセレクタを対象にしたテストコード
- UIのセレクタなどテストに必要な情報は仕様書に記載

## 5. Green:実装
- テストをパスする最小限のコードを書く
- 過剰な実装をしない
- 必要でない限り他の機能も含めた全テストはしない

## 6. Refactor:コードを整理
可読性・信頼性・パフォーマンスの向上に重点を置く。
修正するたびに再テストしてバグが無いことを確認する。

- 可読性向上
    - リファクタ前の行数を記録
    - 使われていないコード、不要な条件分岐は無いか
    - 共通化できる部分はないか（DRY原則）
    - 検証用のデバッグ出力は残っていないか
    - リファクタ後の行数を報告
- 信頼性向上
    - 可読性を向上できる部分はないか
    - バグが入りにくい構造か
- パフォーマンス（処理速度）向上
    - リファクタ前の処理時間を記録
    - 処理を速くできる変数の型はないか
    - 条件分岐を減らせないか
    - ループ回数を減らせないか
    - ループ内の処理を少しでも減らせないか
    - オブジェクト初期化の回数を減らせないか
    - キャッシュして高速化できないか
    - リファクタ後の処理時間を報告

## 7. コミット
- 全テストがパスした状態でのみコミット
