---
description: 仕様書の作成・編集時に自動適用される品質ルールと構成規約
globs:
  - "docs/spec_*.md"
---

# 仕様書作成スキル

仕様書（`docs/spec_*.md`）の作成・編集時に適用されるルール。

## 適用条件

- `docs/spec_*.md` ファイルを新規作成するとき
- 既存の仕様書を編集するとき
- ユーザーが仕様書の作成を依頼したとき

## 前提作業

- `docs/spec_list.md` で対象機能の番号・カテゴリ・機能名・概要を確認する
- 関連する仕様書が `docs/` にあれば読んで依存関係を把握する
- `docs/spec_x-x_specname_template.md` のフォーマットに従う
- ファイル名は `docs/spec_<機能番号>_<機能名英語>.md` とする（例: `docs/spec_1-1_map_display.md`）
- **仕様に新しいUI要素の追加や既存UI要素の変更が含まれるか判定する**。「画面を持つ機能」に限らず、既存画面へのボタン追加・表示変更なども対象となる
- **UI要素の追加・変更がある場合、`docs/mockups/` に対応するモックアップHTMLが存在するか確認する。存在しない場合は仕様書作成より先にモックアップHTMLを作成・更新すること**
- **モックアップHTML作成・更新後、必ずユーザーに提示して承認を得ること。承認を得るまで仕様書の作成に進まないこと**

## 品質ルール（必須遵守）

以下は `spec-quality-checker-rules.md` に基づく品質基準。すべて満たすこと。

| # | ルール | 検証方法 |
|---|--------|---------|
| 1 | 必須セクションがすべて含まれている | 後述の「必須セクション構成」と照合 |
| 2 | 概要に「誰が何のために使う機能か」が書かれている | 概要セクションに主語と目的が明記されているか |
| 3 | UI要素の追加・変更がある機能では `docs/mockups/` にモックアップHTMLが存在し、仕様書からリンクされている。「画面を持つ機能」に限らず、既存画面へのボタン追加・表示変更なども対象 | セクション2にモックアップHTMLへのリンクがあるか |
| 3a | モックアップHTMLが無い、または更新が必要な場合は仕様書作成前に作成・更新し、ユーザーの承認を得ている | モックアップ作成・更新→ユーザー承認→仕様書作成の順序が守られているか |
| 4 | 画面項目定義がモックアップと一致している | 3.1の項目がモックアップの要素を網羅しているか |
| 5 | 処理ロジックにエッジケースの動作が記載されている | 境界値・異常系・特殊条件が記述されているか |
| 6 | データ設計にデータの取得元が書かれている | 3.3にデータソースが明記されているか |
| 7 | テスト方針に「テスト項目の作り方」が書かれている | セクション6がテスト項目自体ではなく方針であるか |
| 8 | 設定・定義・表示文言などの定数がJSONファイルとして外出しされている | 定数がソースコード内にハードコードされず、JSONファイルから読み込む設計になっているか |
| 9 | 仕様書内に設定値・定義値・表示文言を直接記載していない | 色コード・サイズ・ボタンラベル・メッセージ等のUI表示文言を含む具体値は仕様書に書かず、JSONファイルのキー名やファイルパスで参照しているか |
| 10 | 実装前の状態を前提とした記述がない | 「現在の〜を変更する」「ハードコードされている〜を動的にする」のような、実装前の状態からの差分として記述していないか。仕様書は実装完了後も参照される文書であり、あるべき姿を直接記述すること |

## 必須セクション構成

```
# 仕様書: <機能番号> <機能名>

## 1. 概要
  - 誰が何のために使う機能か
  - この仕様の範囲と範囲外
  - 対応デバイス・使用技術
    - 特に指定が無い場合はスマホ、PCに両方対応させること

## 2. 画面レイアウト等の補足資料等の関連資料
  - モックアップHTMLファイルへのリンク
    - UI要素の追加・変更がある場合は必須。既存画面へのボタン追加・表示変更なども対象
    - まだ存在しない、または更新が必要な場合は仕様書作成より先にモックアップHTMLを作成・更新すること
  - 参照ドキュメントへのリンク
  - アセット情報

## 3. 機能詳細
  ### 3.1 画面要素
    - 画面項目定義（モックアップと一致させる）
    - 各要素のサイズ・色・配置は仕様書に具体値を書かず、JSONファイルのキー名で参照する
      - NG: `背景色 #1a1a2e`、`フォントサイズ 42px`
      - OK: `背景色は config.statusBar.bgColor を参照`、`フォントサイズは config.statusBar.unitCount.fontSize を参照`
  ### 3.2 処理ロジック
    - 主要処理フロー
    - エッジケース（境界値・異常系・特殊条件）
    - 定数・設定値・表示文言はソースコード内にハードコードせず、`src/config/` 配下のJSONファイルから読み込むこと
    - 仕様書内にも具体的な定数値を記載しないこと（JSONファイルのキー名で参照する）
  ### 3.3 データ設計
    - データ取得元
    - データ構造（型・フォーマット・制約）
    - 定数・設定値のJSON外出し（`src/config/*.json` に配置。キー定義・デフォルト値はJSONファイルにのみ記載）
    - API設計（エンドポイント・リクエスト/レスポンス）

## 4. 非機能要件
  - パフォーマンス要件
    - 特に指定が無い場合は60fpsを実現すること
  - その他制約

## 5. 考慮事項・制限事項
  - 範囲外事項
  - 将来対応予定

## 6. テスト方針
  - テスト項目の作り方（項目そのものではない）
    - モックアップがある場合は、UIデザイン（要素の存在、場所、色、サイズ）が一致するか検証する
    - 処理ロジックの要件１つずつ検証する
  - テスト観点（正常系・異常系・境界値・性能）
  - テスト手法（Playwright UIテスト・ユニットテスト等）
  - テストデータの準備方針

## 7. テスト項目
  ### <カテゴリ>
  - <テスト項目>
```

## ヒアリング項目

仕様書作成に必要な情報が不足している場合、以下をユーザーに確認する。

- 機能の目的と利用者
- UI要素の追加・変更の有無（新規画面だけでなく、既存画面へのボタン追加・表示変更も含む。該当する場合はモックアップの有無）
- データの取得元・保存先
- パフォーマンス要件の有無
- 他機能との依存関係

## 完成時の自己検証

仕様書を書き終えたら以下をすべて検証し、不合格があれば修正する。

- [ ] 必須セクション（概要・画面設計・処理ロジック・データ設計・非機能要件・テスト方針・テスト項目）がすべて含まれている
- [ ] 概要に「誰が何のために使う機能か」が書かれている
- [ ] UI要素の追加・変更がある機能で `docs/mockups/` にモックアップHTMLが存在し、仕様書からリンクされている（既存画面へのボタン追加・表示変更も対象）
- [ ] モックアップHTMLはユーザーの承認を得た上で仕様書に反映されている
- [ ] 画面項目定義がモックアップと一致している
- [ ] 処理ロジックにエッジケースの動作が記載されている
- [ ] データ設計にデータの取得元が書かれている
- [ ] テスト方針に「テスト項目の作り方」が書かれている
- [ ] 設定・定義・表示文言などの定数がJSONファイルとして外出しされる設計になっている
- [ ] 仕様書内に色コード・サイズ・文言などの具体値を直接記載せず、JSONキー名で参照している
- [ ] 実装前の状態を前提とした記述がない（「現在の〜を変更する」「ハードコードを動的にする」等の差分記述を使わず、あるべき姿を直接記述している）
- [ ] `spec_list.md` と機能番号・機能名が整合している
